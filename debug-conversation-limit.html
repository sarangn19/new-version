<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Conversation Limit</title>
    <style>
        body {
            background: #1F1F1F;
            color: white;
            font-family: monospace;
            padding: 20px;
        }
        .debug-box {
            background: #2A2A2A;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #60a5fa;
        }
        .success { border-left-color: #4ade80; }
        .error { border-left-color: #f87171; }
        .warning { border-left-color: #fbbf24; }
    </style>
</head>
<body>
    <h1>üêõ Debug Conversation Limit</h1>
    
    <div class="debug-box">
        <h3>Current Conversation Count</h3>
        <div id="conversation-count"></div>
    </div>
    
    <div class="debug-box">
        <h3>Function Tests</h3>
        <div id="function-tests"></div>
    </div>
    
    <div class="debug-box">
        <h3>Actions</h3>
        <button onclick="testLimits()" style="background: #60a5fa; color: black; padding: 10px; margin: 5px; border: none; border-radius: 3px;">Test All Limits</button>
        <button onclick="clearAndReload()" style="background: #f87171; color: black; padding: 10px; margin: 5px; border: none; border-radius: 3px;">Clear & Reload</button>
    </div>

    <script>
        function updateConversationCount() {
            try {
                const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');
                const recentChats = JSON.parse(localStorage.getItem('recentChats') || '[]');
                
                document.getElementById('conversation-count').innerHTML = `
                    <div>üìä localStorage 'conversations': ${conversations.length}</div>
                    <div>üìä localStorage 'recentChats': ${recentChats.length}</div>
                    <div>üéØ Expected limit: 8</div>
                `;
            } catch (error) {
                document.getElementById('conversation-count').innerHTML = `
                    <div class="error">‚ùå Error reading storage: ${error.message}</div>
                `;
            }
        }
        
        function testLimits() {
            const results = [];
            
            // Test 1: Check if AI Service Manager respects limit
            if (window.aiServiceManager) {
                try {
                    const conversations = window.aiServiceManager.getRecentConversations(8);
                    results.push(`‚úÖ AI Service Manager: Returns ${conversations.length} conversations (limit: 8)`);
                } catch (error) {
                    results.push(`‚ùå AI Service Manager: Error - ${error.message}`);
                }
            } else {
                results.push(`‚ö†Ô∏è AI Service Manager: Not available`);
            }
            
            // Test 2: Check Firebase Manager default
            if (window.firebaseManager) {
                results.push(`‚úÖ Firebase Manager: Available (default limit should be 8)`);
            } else {
                results.push(`‚ö†Ô∏è Firebase Manager: Not available`);
            }
            
            // Test 3: Check enhanced function
            if (window.loadRecentConversationsEnhanced) {
                results.push(`‚úÖ Enhanced function: Available`);
            } else {
                results.push(`‚ö†Ô∏è Enhanced function: Not available`);
            }
            
            // Test 4: Check regular function
            if (window.loadRecentConversations) {
                results.push(`‚úÖ Regular function: Available`);
            } else {
                results.push(`‚ö†Ô∏è Regular function: Not available`);
            }
            
            document.getElementById('function-tests').innerHTML = results.join('<br>');
        }
        
        function clearAndReload() {
            localStorage.removeItem('conversations');
            localStorage.removeItem('recentChats');
            location.reload();
        }
        
        // Initialize
        updateConversationCount();
        testLimits();
        
        // Update every 2 seconds
        setInterval(updateConversationCount, 2000);
    </script>
</body>
</html>