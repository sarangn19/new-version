<!DOCTYPE html>
<html>
<head>
    <title>Final Profile Sync Test</title>
    <script src="js/profile-manager.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px 15px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>Profile Sync Test</h1>
    
    <div class="test-section">
        <h2>Current Profile (Auto-Updated)</h2>
        <p>Name: <span id="user-name">Loading...</span></p>
        <p>Email: <span id="user-email">Loading...</span></p>
        <p>Initials: <span id="user-initials">Loading...</span></p>
    </div>
    
    <div class="test-section">
        <h2>Update Profile</h2>
        <input type="text" id="new-name" placeholder="Enter new name" value="John Smith">
        <input type="email" id="new-email" placeholder="Enter new email" value="john.smith@test.com">
        <br>
        <button onclick="updateProfile()">Update Profile</button>
        <button onclick="resetProfile()">Reset to Default</button>
    </div>
    
    <div class="test-section">
        <h2>Instructions</h2>
        <p>1. Update the profile using the form above</p>
        <p>2. Open other pages (db.html, chatbot.html, etc.) in new tabs</p>
        <p>3. The profile information should be consistent across all pages</p>
        <p>4. Changes made here should reflect on all other pages immediately</p>
    </div>
    
    <script>
        function updateProfile() {
            const name = document.getElementById('new-name').value.trim();
            const email = document.getElementById('new-email').value.trim();
            
            if (!name || !email) {
                alert('Please enter both name and email');
                return;
            }
            
            if (window.profileManager) {
                profileManager.updateProfile({ name, email });
                alert('Profile updated! Check other pages to see the changes.');
            } else {
                alert('ProfileManager not available');
            }
        }
        
        function resetProfile() {
            if (window.profileManager) {
                profileManager.updateProfile({
                    name: 'User',
                    email: 'user@upsc.com'
                });
                document.getElementById('new-name').value = 'User';
                document.getElementById('new-email').value = 'user@upsc.com';
                alert('Profile reset to default');
            }
        }
        
        // Wait for profile manager to be ready
        function waitForProfileManager() {
            if (window.profileManager) {
                try {
                    // Profile manager is ready, update display
                    document.getElementById('user-name').textContent = profileManager.profileData.name;
                    document.getElementById('user-email').textContent = profileManager.profileData.email;
                    document.getElementById('user-initials').textContent = profileManager.generateInitials(profileManager.profileData.name);
                } catch (error) {
                    console.error('Error updating profile display:', error);
                }
            } else {
                // Wait a bit more, but limit retries
                if ((waitForProfileManager.retries || 0) < 50) {
                    waitForProfileManager.retries = (waitForProfileManager.retries || 0) + 1;
                    setTimeout(waitForProfileManager, 100);
                } else {
                    console.error('ProfileManager failed to load after multiple retries');
                }
            }
        }
        
        waitForProfileManager();
    </script>
</body>
</html>