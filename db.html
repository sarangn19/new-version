<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aspirant Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Primary icon library -->
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Fallback icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        // Robust icon initialization system with fallback
        let iconInitAttempts = 0;
        const maxAttempts = 10;
        let usingFallback = false;

        function initLucideIcons() {
            iconInitAttempts++;

            if (window.lucide && typeof window.lucide.createIcons === 'function') {
                try {
                    window.lucide.createIcons();
                    console.log('✅ Lucide icons initialized successfully on attempt', iconInitAttempts);
                    return true;
                } catch (error) {
                    console.error('❌ Lucide initialization error:', error);
                }
            }

            if (iconInitAttempts < maxAttempts) {
                setTimeout(initLucideIcons, 200);
            } else {
                console.warn('⚠️ Lucide failed, using Font Awesome fallback');
                useFontAwesomeFallback();
            }
            return false;
        }

        function useFontAwesomeFallback() {
            if (usingFallback) return;
            usingFallback = true;

            // Replace Lucide icons with Font Awesome equivalents
            const iconMap = {
                'search': 'fas fa-search',
                'arrow-right': 'fas fa-arrow-right',
                'zap': 'fas fa-bolt',
                'bell-off': 'fas fa-bell-slash',
                'layout-dashboard': 'fas fa-th-large',
                'book-open': 'fas fa-book-open',
                'bar-chart-2': 'fas fa-chart-bar',
                'newspaper': 'fas fa-newspaper',
                'bookmark': 'fas fa-bookmark',
                'bell': 'fas fa-bell',
                'trophy': 'fas fa-trophy',
                'arrow-left': 'fas fa-arrow-left',
                'check-circle': 'fas fa-check-circle',
                'alert-triangle': 'fas fa-exclamation-triangle'
            };

            document.querySelectorAll('[data-lucide]').forEach(icon => {
                const lucideName = icon.getAttribute('data-lucide');
                const faClass = iconMap[lucideName] || 'fas fa-question';
                icon.className = icon.className.replace(/w-\d+|h-\d+/g, '') + ' ' + faClass;
                icon.removeAttribute('data-lucide');
            });

            console.log('✅ Font Awesome fallback icons applied');
        }

        // Multiple initialization triggers
        document.addEventListener('DOMContentLoaded', initLucideIcons);
        window.addEventListener('load', initLucideIcons);

        // Immediate attempt
        if (document.readyState === 'loading') {
            setTimeout(initLucideIcons, 100);
        } else {
            initLucideIcons();
        }
    </script>
    <script src="js/profile-manager.js"></script>
    <script src="js/dashboard-fixes.js"></script>
    <link href="styles/glassmorphism.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&family=Montserrat:wght@400&family=Roboto:wght@300&display=swap"
        rel="stylesheet">

    <style>
        /* Define custom colors and font families */
        :root {
            --bg-dark-1: #1F1F1F;
            /* Main Background */
            --bg-dark-2: #1A1A1A;
            /* Card/Sidebar Background */
            --teal-primary: #2C7A7B;
            /* Deep Teal for Revision Card and Primary Actions */
            --teal-secondary: #22543D;
            /* Slightly darker teal for gradient */
            --text-faded: rgba(255, 255, 255, 0.5);

            /* --- GLASSMORPHISM VARIABLES --- */
            --search-bg-glass: rgba(255, 255, 255, 0.02);
            --search-border-glass: rgba(255, 255, 255, 0.05);
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark-1);
        }

        .montserrat {
            font-family: 'Montserrat', sans-serif;
        }

        .roboto {
            font-family: 'Roboto', sans-serif;
        }

        /* Hide scrollbar */
        .scroll-hidden::-webkit-scrollbar {
            display: none;
        }

        .scroll-hidden {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* --- Custom Styles for Subtle Glassmorphism Search Bar --- */
        .glass-search-container {
            background-color: var(--search-bg-glass);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid var(--search-border-glass);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .glass-search-container:focus-within {
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        /* --- UX ENHANCEMENT: Button Gradient & Microinteraction --- */
        .btn-primary-gradient {
            background: linear-gradient(135deg, var(--teal-primary) 0%, var(--teal-secondary) 100%);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        .btn-primary-gradient:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.6);
            transform: translateY(-2px);
            opacity: 0.95;
        }

        .btn-primary-gradient:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        /* Secondary Button (Snooze/Outline style) */
        .btn-secondary-subtle {
            background-color: rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            /* Added border for consistency */
        }

        .btn-secondary-subtle:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .btn-secondary-subtle:active {
            transform: translateY(0);
        }

        /* --- UX ENHANCEMENT: Content Card Hover Lift --- */
        .content-card-group {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .content-card-group:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.7);
        }

        /* Arrow Circle Button Style */
        .arrow-circle-button {
            width: 44px;
            height: 44px;
            background-color: var(--bg-dark-1);
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .arrow-circle-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Toast Notification Styling */
        #toast-notification {
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(100%);
        }

        #toast-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Image specific styles for object fit and positioning */
        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        /* Flashcard specific styles for 3D flip */
        .perspective-1000 {
            perspective: 1000px;
        }

        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* Accessibility helpers */
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        /* Make focused elements clearly visible */
        :focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 122, 123, 0.25);
            border-radius: 6px;
        }

        /* Unified button radius */
        :root {
            --btn-radius: 12px;
        }

        .btn-unified {
            border-radius: var(--btn-radius);
        }

        /* Slight background gradient for depth */
        body {
            background: linear-gradient(180deg, rgba(14, 18, 20, 1) 0%, rgba(23, 26, 28, 1) 40%);
        }

        /* Small text increased contrast and size */
        .text-small-strong {
            color: rgba(255, 255, 255, 0.88);
            font-size: 0.85rem;
        }

        /* Tighter content grouping */
        .content-grid-tight {
            gap: 8px;
        }

        /* --- REVISION ILLUSTRATION STYLES --- */
        #revision-reading-svg {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Define the pivot point for all rotating elements using CSS */
        #lamp-arm,
        #light-beam,
        #lamp-head {
            transform-origin: 1310px 105px;
        }

        /* --- REMINDERS BOARD STYLES --- */
        .reminder-note {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border: 1px solid #F59E0B;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transform: rotate(-1deg);
            transition: all 0.2s ease;
        }

        .reminder-note:nth-child(even) {
            transform: rotate(1deg);
        }

        .reminder-note:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            z-index: 10;
        }

        .reminder-note textarea {
            background: transparent;
            border: none;
            resize: none;
            outline: none;
            color: #92400E;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .reminder-note textarea::placeholder {
            color: #D97706;
            opacity: 0.7;
        }

        #reminders-board.minimized #board-content {
            display: none;
        }

        #reminders-board.minimized {
            background: rgba(42, 42, 42, 0.8);
        }

        .reminder-delete-btn {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .reminder-note:hover .reminder-delete-btn {
            opacity: 1;
        }

        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        textarea:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 122, 123, 0.25);
            border-radius: 8px;
        }

        /* Remove teal focus ring for search input; the container shows focus instead */
        .glass-search-container input:focus-visible {
            outline: none !important;
            box-shadow: none !important;
        }

        /* Skip link visible on keyboard focus */
        .skip-link {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #111;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            z-index: 10000;
            transform: translateY(-100%);
            transition: transform 0.18s ease-in-out;
        }

        .skip-link:focus,
        .skip-link:active {
            transform: translateY(0);
        }

        /* --- GLASSMORPHISM EFFECTS --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .glass-sidebar {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* --- SMOOTH ANIMATIONS --- */
        .page-transition {
            animation: fadeInUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            transform: translateX(4px);
            background: rgba(42, 42, 42, 0.8);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(44, 122, 123, 0.2), rgba(42, 42, 42, 0.9));
            border-left: 3px solid var(--teal-primary);
        }
    </style>
</head>

<body class="min-h-screen text-white antialiased scroll-hidden">

    <a href="#main-content" class="skip-link" data-skip-link>Skip to main content</a>

    <!-- Toast Notification -->
    <div id="toast-notification"
        class="fixed right-4 bottom-4 bg-gray-700/90 backdrop-blur-sm text-white px-5 py-2.5 rounded-xl shadow-2xl flex items-center space-x-2"
        role="status" aria-live="polite">
        <span id="toast-icon-container">
            <i id="toast-icon" data-lucide="info" class="w-5 h-5 text-green-400"></i>
        </span>
        <span id="toast-text" class="font-medium text-sm">System feedback goes here.</span>
        <!-- REDUCED from text-base -->
    </div>

    <!-- JavaScript for Logic and Interactivity -->
    <script>
        // Content data - will be loaded from user's actual study materials
        const contentData = [
            {
                id: 1,
                title: "Indian Constitution - Fundamental Rights",
                description: "Comprehensive study material covering Articles 12-35 of the Indian Constitution, including fundamental rights, their scope, limitations, and landmark judgments.",
                date: "Dec 15, 2024",
                tag: "Revision",
                imageUrl: "image/constitution.jpg",
                bookmarked: false
            },
            {
                id: 2,
                title: "Economic Survey 2024 - Key Highlights",
                description: "Analysis of India's economic performance, growth projections, sectoral developments, and policy recommendations from Economic Survey 2024.",
                date: "Dec 14, 2024",
                tag: "New",
                imageUrl: "image/economy.jpg",
                bookmarked: true
            },
            {
                id: 3,
                title: "Environment & Climate Change",
                description: "Current environmental challenges, climate policies, international agreements, and India's commitments to sustainable development goals.",
                date: "Dec 13, 2024",
                tag: "Mock Test",
                imageUrl: "image/environment.jpg",
                bookmarked: false
            },
            {
                id: 4,
                title: "Modern History - Freedom Struggle",
                description: "Detailed coverage of India's independence movement, key personalities, major events, and their impact on contemporary India.",
                date: "Dec 12, 2024",
                tag: "Unattempted",
                imageUrl: "image/history.jpg",
                bookmarked: false
            }
        ];

        const flashcards = [
            {
                id: 1,
                front: "What is the basic structure doctrine?",
                back: "The basic structure doctrine is a judicial principle that certain fundamental features of the Constitution cannot be altered by Parliament through constitutional amendments."
            },
            {
                id: 2,
                front: "Who coined the term 'Satyagraha'?",
                back: "Mahatma Gandhi coined the term 'Satyagraha', which means 'holding onto truth' or non-violent resistance."
            },
            {
                id: 3,
                front: "What is GDP deflator?",
                back: "GDP deflator is a measure of the level of prices of all new, domestically produced, final goods and services in an economy."
            }
        ];

        // Daily Challenge Data - will be generated based on user progress
        const dailyChallenge = {
            mcqs: [
                {
                    question: "Which Article of the Indian Constitution deals with the Right to Equality?",
                    options: ["Article 14", "Article 15", "Article 16", "All of the above"],
                    answerIndex: 3,
                    explanation: "Articles 14, 15, and 16 all deal with different aspects of the Right to Equality. Article 14 provides equality before law, Article 15 prohibits discrimination, and Article 16 ensures equality of opportunity in public employment."
                },
                {
                    question: "The Economic Survey is presented by which ministry?",
                    options: ["Ministry of Finance", "Ministry of Commerce", "NITI Aayog", "RBI"],
                    answerIndex: 0,
                    explanation: "The Economic Survey is an annual document prepared by the Economic Division of the Department of Economic Affairs, Ministry of Finance, Government of India."
                },
                {
                    question: "Which gas is primarily responsible for global warming?",
                    options: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"],
                    answerIndex: 2,
                    explanation: "Carbon dioxide (CO2) is the primary greenhouse gas responsible for global warming, mainly released through burning fossil fuels and deforestation."
                }
            ],
            flashcards: flashcards,
            currentMCQ: 0,
            currentFlashcard: 0
        };

        // --- GLOBAL STATE ---
        const skeletonCount = 4;
        let isLoading = true; // Controls content card display (skeleton vs real)
        let currentFilter = 'All'; // Active content filter

        let currentFlashcardIndex = 0;
        let flashcardFlipped = false;

        let selectedOptionIndex = null; // Quiz state
        let quizAttempted = false;
        let quizCorrect = false;

        // --- TOAST & UTILITIES ---
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast-notification');
            const toastText = document.getElementById('toast-text');
            const toastIconContainer = document.getElementById('toast-icon-container');

            toastText.textContent = message;
            toast.className = 'fixed right-4 bottom-4 px-5 py-2.5 rounded-xl shadow-2xl flex items-center space-x-2 transition-all duration-300';

            let iconName = 'info';
            let bgColor = 'bg-gray-700/90';
            let iconColor = 'text-teal-400';
            let iconSize = 'w-5 h-5';

            if (type === 'success') {
                iconName = 'check-circle';
                bgColor = 'bg-green-700/90';
                iconColor = 'text-white';
            } else if (type === 'error') {
                iconName = 'x-octagon';
                bgColor = 'bg-red-700/90';
                iconColor = 'text-white';
            }

            toast.classList.add(bgColor, 'text-white');

            // Recreate the icon element to update attributes correctly
            toastIconContainer.innerHTML = `<i id="toast-icon" data-lucide="${iconName}" class="${iconColor} ${iconSize}"></i>`;
            if (window.iconManager) window.iconManager.refresh();

            requestAnimationFrame(() => {
                toast.classList.add('show');
            });

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3500);
        }

        // --- CONTENT CARD LOGIC ---

        function toggleBookmark(id, btn) {
            const item = contentData.find(d => d.id === id);
            if (item) {
                item.bookmarked = !item.bookmarked;
                // Update button aria state if we have it
                if (btn) {
                    btn.setAttribute('aria-pressed', item.bookmarked ? 'true' : 'false');
                    const sr = btn.querySelector('.sr-only');
                    if (sr) sr.textContent = item.bookmarked ? `Remove bookmark for ${item.title}` : `Add bookmark for ${item.title}`;
                    // swap icon classes (simple approach: re-render icons after content update)
                }

                renderContent(currentFilter); // Re-render content list
                showToast(item.bookmarked ? `"${item.title}" bookmarked!` : `Bookmark removed from "${item.title}".`, 'info');
            }
        }

        function createContentCardHTML(item, isSkeleton = false) {
            if (isSkeleton) {
                return `
                    <div class="bg-[var(--bg-dark-2)] rounded-2xl overflow-hidden shadow-xl relative pb-6 animate-pulse">
                        <div class="h-32 rounded-t-2xl bg-gray-700"></div>
                        <div class="px-4 pt-4 space-y-2">
                            <div class="h-5 w-3/4 bg-gray-600 rounded"></div>
                            <div class="h-3 w-1/3 bg-gray-700 rounded"></div>
                            <div class="h-3 bg-gray-700 rounded"></div>
                            <div class="h-3 w-5/6 bg-gray-700 rounded"></div>
                            <div class="h-3 w-1/4 bg-gray-600 rounded mt-4"></div>
                        </div>
                        <div class="absolute top-3 right-3 w-8 h-8 rounded-full bg-gray-600"></div>
                        <div class="absolute bottom-6 right-6 w-12 h-12 rounded-full bg-gray-600"></div>
                    </div>
                `;
            }

            // Real card HTML with Bookmark
            const bookmarkIcon = item.bookmarked ? 'bookmark' : 'bookmark-plus';
            const bookmarkColor = item.bookmarked ? 'text-yellow-400 fill-yellow-400' : 'text-white/50';
            const tagColor = item.tag === 'Revision' ? 'text-red-400' : (item.tag === 'Mock Test' ? 'text-blue-400' : 'text-teal-400');


            return `
                <article class="content-card-group bg-[var(--bg-dark-2)] rounded-2xl overflow-hidden shadow-xl relative pb-6 transition duration-300 hover:shadow-2xl" aria-labelledby="content-title-${item.id}"> 
                    <div class="h-32 rounded-t-2xl border-b border-gray-700 overflow-hidden">
                        <img src="${item.imageUrl}" onerror="this.onerror=null; this.src='image/default-card.png';" alt="${item.title} illustration" class="card-image">
                    </div>

                    <div class="px-4 space-y-1 pt-3">
                        <div class="space-y-1">
                            <h4 id="content-title-${item.id}" class="text-sm font-normal leading-tight text-white">${item.title}</h4> <!-- REDUCED from text-[18px] -->
                            <p class="montserrat text-small-strong font-normal leading-4">Uploaded on ${item.date}</p> <!-- REDUCED from text-sm -->
                        </div>
                        <p class="roboto text-small-strong font-light leading-snug h-14 overflow-hidden" aria-hidden="true"> <!-- REDUCED from text-sm -->
                            ${item.description}
                        </p>
                        <ul class="mt-2 text-xs text-white/80 list-disc list-inside" aria-hidden="true">
                            <li class="truncate">Brief highlight or topic bullet 1</li>
                            <li class="truncate">Highlight or subtopic 2</li>
                        </ul>
                        <div class="pt-2">
                            <span class="font-medium text-sm leading-snug ${tagColor}" aria-label="Tag: ${item.tag}">${item.tag}</span> <!-- REDUCED from text-[18px] -->
                        </div>
                    </div>

                    <!-- Bookmark Button -->
                    <button onclick="toggleBookmark(${item.id}, this)" aria-pressed="${item.bookmarked ? 'true' : 'false'}" aria-label="${item.bookmarked ? 'Remove bookmark' : 'Add bookmark'} for ${item.title}" class="bookmark-btn absolute top-3 right-3 min-w-[44px] min-h-[44px] w-11 h-11 bg-[var(--bg-dark-1)] rounded-full flex items-center justify-center shadow-lg z-20 transition hover:bg-gray-700">
                        <span class="sr-only">${item.bookmarked ? 'Remove bookmark' : 'Add bookmark'} for ${item.title}</span>
                        <i data-lucide="${bookmarkIcon}" class="${bookmarkColor} w-5 h-5 transition duration-300" aria-hidden="true"></i>
                    </button>
                    
                    <!-- Arrow Button -->
                    <button aria-label="Open ${item.title}" class="absolute bottom-6 right-6 min-w-[44px] min-h-[44px] w-12 h-12 bg-[var(--bg-dark-1)] rounded-full flex items-center justify-center shadow-xl z-10 transition-all duration-300 group-hover:scale-110 group-hover:bg-gray-700">
                        <i data-lucide="arrow-right" class="text-white w-5 h-5 transition duration-300 group-hover:rotate-45" aria-hidden="true"></i>
                    </button>
                </article>
            `;
        }

        function renderContent() {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = '';

            if (isLoading) {
                for (let i = 0; i < skeletonCount; i++) {
                    grid.innerHTML += createContentCardHTML(null, true);
                }
            } else {
                const filteredData = contentData.filter(item => {
                    if (currentFilter === 'All') return true;
                    if (currentFilter === 'Revision' && item.tag === 'Revision') return true;
                    if (currentFilter === 'Unattempted' && item.tag === 'Unattempted') return true;
                    if (currentFilter === 'Mock Test' && item.tag === 'Mock Test') return true;
                    if (currentFilter === 'Recent' && item.tag === 'New') return true;
                    // Add logic to filter by bookmarked if needed later
                    return false;
                });

                filteredData.forEach(item => {
                    grid.innerHTML += createContentCardHTML(item, false);
                });
                if (window.iconManager) window.iconManager.refresh(); // Re-render icons after adding content
            }
        }

        // --- FILTER CHIP LOGIC ---

        function setActiveFilter(filter) {
            currentFilter = filter;
            renderFilterChips();
            renderContent();
        }

        function renderFilterChips() {
            const chipsContainer = document.getElementById('filter-chips');
            const filters = ['All', 'Recent', 'Unattempted', 'Revision', 'Mock Test'];

            chipsContainer.innerHTML = filters.map(filter => {
                const isActive = filter === currentFilter;
                // Chip text size reduced to text-xs
                const classes = isActive
                    ? 'btn-primary-gradient px-3 py-1 text-xs font-medium rounded-full shadow-md transition' // REDUCED from px-4 py-1.5 text-sm
                    : 'bg-gray-700/70 border border-white/10 px-3 py-1 text-xs text-white/80 rounded-full transition hover:bg-gray-700'; // REDUCED from px-4 py-1.5 text-sm

                return `
                    <button onclick="setActiveFilter('${filter}')" class="${classes}">
                        ${filter}
                    </button>
                `;
            }).join('');
        }

        // --- FLASHCARD LOGIC ---

        function renderFlashcard() {
            const cardContainer = document.getElementById('flashcard-container');
            const card = dailyChallenge.flashcards[dailyChallenge.currentFlashcard];

            cardContainer.innerHTML = `
                <button id="card-inner" aria-pressed="${flashcardFlipped ? 'true' : 'false'}" aria-label="Flashcard: ${card.front}. Press Enter or Space to flip" 
                     onclick="flipFlashcard()" 
                     class="w-full h-full cursor-pointer transition-transform duration-500 rounded-lg shadow-xl 
                     bg-[var(--bg-dark-2)] p-4 flex items-center justify-center 
                     text-center border border-white/10 hover:border-teal-primary focus:outline-none focus-visible:ring-2 focus-visible:ring-teal-400" 
                     style="transform-style: preserve-3d; ${flashcardFlipped ? 'transform: rotateY(180deg);' : 'transform: rotateY(0deg);'}">
                    
                    <!-- Front Face -->
                    <div id="card-front" class="absolute w-full h-full p-4 flex items-center justify-center backface-hidden">
                        <p class="text-xs font-light text-white/50 absolute bottom-2">Press Enter or Space to flip</p>
                        <p class="text-base font-semibold text-teal-400 pt-8">${card.front}</p> <!-- REDUCED from text-xl -->
                    </div>
                    
                    <!-- Back Face -->
                    <div id="card-back" class="absolute w-full h-full p-4 flex items-center justify-center backface-hidden" style="transform: rotateY(180deg);">
                        <p class="text-xs font-light text-white/80">${card.back}</p> <!-- REDUCED from text-sm -->
                    </div>
                </button>
            `;

            document.getElementById('flashcard-prev').disabled = dailyChallenge.currentFlashcard === 0;
            document.getElementById('flashcard-next').disabled = dailyChallenge.currentFlashcard === dailyChallenge.flashcards.length - 1;
        }

        function flipFlashcard() {
            flashcardFlipped = !flashcardFlipped;
            renderFlashcard();
        }

        function navigateFlashcard(direction) {
            flashcardFlipped = false; // Reset flip state
            if (direction === 'next' && dailyChallenge.currentFlashcard < dailyChallenge.flashcards.length - 1) {
                dailyChallenge.currentFlashcard++;
            } else if (direction === 'prev' && dailyChallenge.currentFlashcard > 0) {
                dailyChallenge.currentFlashcard--;
            }
            renderFlashcard();
        }

        function flashcardAction(action) {
            const card = dailyChallenge.flashcards[dailyChallenge.currentFlashcard];
            if (action === 'learned') {
                showToast(`Card on "${card.front.substring(0, 30)}..." marked as Learned!`, 'success');
                // In a real app, you'd remove this card from the active deck
            } else if (action === 'weak') {
                showToast(`Card on "${card.front.substring(0, 30)}..." flagged as Weak Area.`, 'error');
                // In a real app, you'd mark it for priority revision
            }
            // Move to next card (if not the last one)
            if (dailyChallenge.currentFlashcard < dailyChallenge.flashcards.length - 1) {
                navigateFlashcard('next');
            } else {
                showToast("End of Flashcards for today! Great job.", 'info');
            }
        }

        // --- DAILY QUIZ LOGIC ---

        function renderQuiz() {
            const optionsContainer = document.getElementById('quiz-options');
            const questionEl = document.getElementById('daily-quiz-question');
            const feedbackDiv = document.getElementById('quiz-feedback');
            const checkBtn = document.getElementById('check-answer-btn');
            const retryBtn = document.getElementById('retry-quiz-btn');
            const nextBtn = document.getElementById('next-question-btn');
            const questionCounter = document.getElementById('question-counter');

            // Populate the question text
            const currentMCQ = dailyChallenge.mcqs[dailyChallenge.currentMCQ];
            if (questionEl) questionEl.textContent = currentMCQ.question;
            if (questionCounter) questionCounter.textContent = `Question ${dailyChallenge.currentMCQ + 1} of ${dailyChallenge.mcqs.length}`;

            optionsContainer.innerHTML = currentMCQ.options.map((option, index) => {
                // Use role=radio buttons for accessibility
                let classes = 'p-3 rounded-xl cursor-pointer transition duration-200 text-white border border-white/10 inline-flex items-center w-full text-left';
                let ariaChecked = 'false';

                if (quizAttempted) {
                    if (index === currentMCQ.answerIndex) {
                        classes += ' bg-green-800/50 border-green-500 shadow-md';
                        ariaChecked = 'true';
                    } else if (index === selectedOptionIndex) {
                        classes += ' bg-red-800/50 border-red-500 shadow-md';
                        ariaChecked = 'true';
                    } else {
                        classes += ' bg-gray-700/50';
                    }
                } else {
                    classes += ' bg-gray-700/50 hover:bg-gray-600/70';
                    if (index === selectedOptionIndex) {
                        classes += ' border-teal-primary ring-2 ring-teal-primary shadow-lg';
                        ariaChecked = 'true';
                    }
                }

                return `
                    <button role="radio" tabindex="0" aria-checked="${ariaChecked}" class="${classes}" onclick="selectQuizOption(${index})" onkeydown="if(event.key==='Enter'||event.key===' '){ event.preventDefault(); selectQuizOption(${index}); }">
                        <span class="text-sm">${String.fromCharCode(65 + index)}. ${option}</span>
                    </button>
                `;
            }).join('');

            if (quizAttempted) {
                checkBtn.classList.add('hidden');
                if (dailyChallenge.currentMCQ < dailyChallenge.mcqs.length - 1) {
                    nextBtn.classList.remove('hidden');
                    retryBtn.classList.add('hidden');
                } else {
                    nextBtn.classList.add('hidden');
                    retryBtn.classList.remove('hidden');
                }
                feedbackDiv.classList.remove('hidden');
                feedbackDiv.innerHTML = `
                    <div class="p-3 rounded-lg ${quizCorrect ? 'bg-green-700/30 border-l-4 border-green-500' : 'bg-red-700/30 border-l-4 border-red-500'}">
                        <p class="text-xs font-medium ${quizCorrect ? 'text-green-400' : 'text-red-400'}"> <!-- REDUCED from text-sm -->
                            ${quizCorrect ? 'Correct! Excellent work.' : 'Incorrect.'}
                        </p>
                        <p class="text-xs text-white/70 pt-1">${currentMCQ.explanation}</p>
                    </div>
                `;
            } else {
                checkBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                retryBtn.classList.add('hidden');
                feedbackDiv.classList.add('hidden');
                checkBtn.disabled = selectedOptionIndex === null;
            }
        }

        function selectQuizOption(index) {
            if (quizAttempted) return;
            selectedOptionIndex = index;
            renderQuiz();
        }

        function checkQuizAnswer() {
            if (selectedOptionIndex === null) {
                showToast("Please select an option first!", 'error');
                return;
            }

            quizAttempted = true;
            quizCorrect = selectedOptionIndex === dailyChallenge.mcqs[dailyChallenge.currentMCQ].answerIndex;

            if (quizCorrect) {
                showToast("You nailed the daily challenge!", 'success');
            } else {
                showToast("Keep going, you'll get it next time.", 'info');
            }

            renderQuiz();
        }

        function nextQuestion() {
            if (dailyChallenge.currentMCQ < dailyChallenge.mcqs.length - 1) {
                dailyChallenge.currentMCQ++;
                quizAttempted = false;
                selectedOptionIndex = null;
                quizCorrect = false;
                renderQuiz();
            }
        }

        function resetQuiz() {
            dailyChallenge.currentMCQ = 0;
            quizAttempted = false;
            selectedOptionIndex = null;
            quizCorrect = false;
            showToast("Quiz reset. Good luck!", 'info');
            renderQuiz();
        }

        // --- DASHBOARD ACTIONS (from previous code) ---
        function handleSearch(event) {
            event.preventDefault();
            const searchInput = document.getElementById('search-input');
            const query = searchInput.value.trim();

            if (query) {
                console.log("Searching for:", query);
                showToast(`Searching for "${query}"...`, 'info');
                setTimeout(() => {
                    showToast(`Search for "${query}" completed.`, 'success');
                }, 1500);
            } else {
                showToast("Please enter a query.", 'error');
            }
        }

        function handleSnooze() {
            showToast("Revision snoozed! Reminder set for tomorrow.", 'success');
            console.log("Revision snoozed.");
        }

        function getInitials(fullName) {
            const names = fullName.split(' ');
            if (names.length === 1) return names[0].charAt(0).toUpperCase();
            if (names.length > 1) return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
            return 'A';
        }

        // --- REMINDERS BOARD FUNCTIONALITY (GLOBAL SCOPE) ---
        let reminders = JSON.parse(localStorage.getItem('dashboardReminders')) || [];
        let reminderIdCounter = Date.now();

        function saveReminders() {
            localStorage.setItem('dashboardReminders', JSON.stringify(reminders));
        }

        function toggleBoard() {
            const board = document.getElementById('reminders-board');
            const minimizeBtn = document.getElementById('minimize-board-btn');
            const minimizeIcon = minimizeBtn.querySelector('i');

            board.classList.toggle('minimized');

            if (board.classList.contains('minimized')) {
                minimizeIcon.setAttribute('data-lucide', 'maximize-2');
                minimizeBtn.setAttribute('title', 'Maximize Board');
            } else {
                minimizeIcon.setAttribute('data-lucide', 'minus');
                minimizeBtn.setAttribute('title', 'Minimize Board');
            }

            // Refresh icons
            if (window.lucide) window.lucide.createIcons();
        }

        function addNewReminder() {
            const reminder = {
                id: reminderIdCounter++,
                text: '',
                timestamp: Date.now()
            };

            reminders.unshift(reminder);
            saveReminders();
            renderReminders();

            // Focus on the new reminder
            setTimeout(() => {
                const newReminderTextarea = document.querySelector(`[data-reminder-id="${reminder.id}"] textarea`);
                if (newReminderTextarea) {
                    newReminderTextarea.focus();
                }
            }, 100);
        }

        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            saveReminders();
            renderReminders();
            showToast('Reminder deleted', 'info');
        }

        function updateReminder(id, text) {
            const reminder = reminders.find(r => r.id === id);
            if (reminder) {
                reminder.text = text;
                saveReminders();
            }
        }

        function renderReminders() {
            const container = document.getElementById('reminders-container');
            const emptyState = document.getElementById('empty-state');

            if (reminders.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            container.innerHTML = reminders.map(reminder => `
                <div class="reminder-note p-3 rounded-lg relative" data-reminder-id="${reminder.id}">
                    <button onclick="deleteReminder(${reminder.id})" 
                        class="reminder-delete-btn absolute top-1 right-1 w-6 h-6 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center text-white text-xs transition-colors"
                        title="Delete reminder">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                    <textarea 
                        placeholder="Type your reminder here..."
                        class="w-full h-20 pr-8"
                        oninput="updateReminder(${reminder.id}, this.value)"
                        onblur="if(!this.value.trim()) deleteReminder(${reminder.id})"
                    >${reminder.text}</textarea>
                    <div class="text-xs text-amber-700 mt-1 opacity-70">
                        ${new Date(reminder.timestamp).toLocaleDateString()}
                    </div>
                </div>
            `).join('');

            // Refresh icons for delete buttons
            if (window.lucide) window.lucide.createIcons();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Profile information is now handled by profile-manager.js

            // Load saved profile picture
            const savedDP = localStorage.getItem('selectedDP');
            const userInitialsEl = document.getElementById('user-initials');

            if (savedDP && userInitialsEl) {
                const parentDiv = userInitialsEl.parentElement;
                parentDiv.innerHTML = `<img src="image/${savedDP}.png" alt="Profile Picture" class="w-full h-full object-cover">`;
            } else if (userInitialsEl && window.profileManager) {
                userInitialsEl.textContent = profileManager.generateInitials(profileManager.profileData.name);
            }

            // Initial Render Calls
            renderContent(); // Show skeletons initially
            renderFilterChips();
            renderFlashcard();
            renderQuiz();

            // Simulate data fetching delay
            setTimeout(() => {
                isLoading = false;
                renderContent(); // Render real content
                showToast("Content successfully loaded.", 'success');
            }, 1500);

            // Notification functionality
            const notifications = [];

            function showNotificationsModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                  <div class="bg-[var(--bg-dark-2)] rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden border border-white/10">
                    <div class="flex items-center justify-between mb-6">
                      <h3 class="text-lg font-medium">Notifications</h3>
                      <div class="flex items-center gap-3">
                        <button id="markAllRead" class="text-sm text-[var(--teal-primary)] hover:text-[var(--teal-primary)]/80">Mark all as read</button>
                        <button id="closeNotificationsModal" class="text-white/50 hover:text-white">
                          <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                      </div>
                    </div>
                    <div class="overflow-y-auto max-h-[60vh] space-y-3">
                      ${notifications.map(notif => `
                        <div class="flex items-start gap-3 p-4 rounded-lg hover:bg-white/5 transition ${!notif.read ? 'bg-white/5 border-l-2 border-[var(--teal-primary)]' : ''}">
                          <div class="w-10 h-10 rounded-lg bg-[var(--teal-primary)]/20 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="${notif.type === 'challenge' ? 'trophy' : notif.type === 'reminder' ? 'clock' : notif.type === 'content' ? 'file-plus' : 'award'}" class="w-5 h-5 text-[var(--teal-primary)]"></i>
                          </div>
                          <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between">
                              <h4 class="text-white font-medium text-sm">${notif.title}</h4>
                              ${!notif.read ? '<div class="w-2 h-2 bg-[var(--teal-primary)] rounded-full flex-shrink-0 mt-1"></div>' : ''}
                            </div>
                            <p class="text-white/70 text-sm mt-1">${notif.message}</p>
                            <p class="text-white/50 text-xs mt-2">${notif.time}</p>
                          </div>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                `;

                document.body.appendChild(modal);

                modal.querySelector('#closeNotificationsModal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });

                modal.querySelector('#markAllRead').addEventListener('click', () => {
                    notifications.forEach(notif => notif.read = true);
                    document.body.removeChild(modal);
                    showToast('All notifications marked as read', 'success');
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });

                if (window.lucide && typeof window.lucide.createIcons === 'function') {
                    window.lucide.createIcons();
                }
                if (window.iconManager) window.iconManager.refresh();
            }

            // Add notification button event listener
            document.getElementById('notification-btn')?.addEventListener('click', () => {
                showNotificationsModal();
            });

            // Bookmark functionality - get from localStorage
            function getBookmarks() {
                const bookmarks = localStorage.getItem('userBookmarks');
                return bookmarks ? JSON.parse(bookmarks) : [
                    // Default bookmarks if none exist
                    { id: 1, title: "Indian Constitution - Fundamental Rights", type: "Note", date: "2 days ago" },
                    { id: 2, title: "Economic Survey 2024 - Key Points", type: "Note", date: "1 week ago" },
                    { id: 3, title: "Environment & Ecology Flashcards", type: "Flashcard", date: "3 days ago" },
                    { id: 4, title: "Polity MCQ Set 1", type: "MCQ", date: "5 days ago" },
                    { id: 5, title: "Modern History Timeline", type: "Note", date: "1 week ago" }
                ];
            }

            function saveBookmarks(bookmarks) {
                localStorage.setItem('userBookmarks', JSON.stringify(bookmarks));
            }

            function showBookmarksModal() {
                const bookmarkedContent = getBookmarks();
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                  <div class="bg-[var(--bg-dark-2)] rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden border border-white/10">
                    <div class="flex items-center justify-between mb-6">
                      <h3 class="text-lg font-medium">Bookmarked Content</h3>
                      <button id="closeBookmarksModal" class="text-white/50 hover:text-white">
                        <i data-lucide="x" class="w-5 h-5"></i>
                      </button>
                    </div>
                    <div class="overflow-y-auto max-h-[60vh]">
                      ${bookmarkedContent.length === 0 ?
                        '<div class="text-center py-8 text-white/60">No bookmarked content yet</div>' :
                        bookmarkedContent.map(item => `
                          <div class="flex items-center justify-between p-4 rounded-lg hover:bg-white/5 transition">
                            <div class="flex items-center gap-3">
                              <div class="w-10 h-10 rounded-lg bg-[var(--teal-primary)]/20 flex items-center justify-center">
                                <i data-lucide="${item.type === 'Note' ? 'file-text' : item.type === 'Flashcard' ? 'layers' : item.type === 'News' ? 'newspaper' : 'help-circle'}" class="w-5 h-5 text-[var(--teal-primary)]"></i>
                              </div>
                              <div>
                                <h4 class="text-white font-medium">${item.title}</h4>
                                <p class="text-white/60 text-sm">${item.type}${item.category ? ` (${item.category})` : ''} • ${item.date}</p>
                              </div>
                            </div>
                            <div class="flex items-center gap-2">
                              <button class="open-bookmark-btn p-2 rounded-lg hover:bg-white/10 transition cursor-pointer" title="Open" data-id="${item.id}">
                                <i data-lucide="external-link" class="w-4 h-4 text-white/60"></i>
                              </button>
                              <button class="remove-bookmark-btn p-2 rounded-lg hover:bg-red-500/20 transition cursor-pointer" title="Remove bookmark" data-id="${item.id}">
                                <i data-lucide="bookmark-x" class="w-4 h-4 text-red-400"></i>
                              </button>
                            </div>
                          </div>
                        `).join('')
                    }
                    </div>
                  </div>
                `;

                document.body.appendChild(modal);

                modal.querySelector('#closeBookmarksModal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });

                // Add click handlers for bookmark actions
                modal.querySelectorAll('.open-bookmark-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = parseInt(e.currentTarget.dataset.id);
                        const bookmarks = getBookmarks();
                        const item = bookmarks.find(bookmark => bookmark.id === itemId);
                        if (item) {
                            if (item.type === 'News') {
                                // Close bookmark modal and redirect to news page
                                document.body.removeChild(modal);
                                showToast(`Opening ${item.title}...`, 'info');
                                // If we're not on news page, redirect there with news ID
                                if (!window.location.href.includes('news.html')) {
                                    window.location.href = `news.html?openNews=${item.id}`;
                                } else {
                                    // If already on news page, just open the modal
                                    if (window.viewNews) {
                                        window.viewNews(item.id);
                                    }
                                }
                            } else {
                                showToast(`Opening ${item.title}...`, 'info');
                                // Here you could redirect to other content types
                            }
                        }
                    });
                });

                modal.querySelectorAll('.remove-bookmark-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = parseInt(e.currentTarget.dataset.id);
                        const bookmarks = getBookmarks();
                        const itemIndex = bookmarks.findIndex(item => item.id === itemId);
                        if (itemIndex > -1) {
                            const item = bookmarks[itemIndex];
                            bookmarks.splice(itemIndex, 1);
                            saveBookmarks(bookmarks);
                            showToast(`Removed "${item.title}" from bookmarks`, 'success');
                            document.body.removeChild(modal);
                            // Reopen modal with updated content
                            setTimeout(() => showBookmarksModal(), 100);
                        }
                    });
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });

                if (window.lucide && typeof window.lucide.createIcons === 'function') {
                    window.lucide.createIcons();
                }
                if (window.iconManager) window.iconManager.refresh();
            }

            // Add bookmark button event listener
            document.getElementById('bookmarks-btn')?.addEventListener('click', () => {
                showBookmarksModal();
            });

            // Enhanced icon manager for Lucide icons
            window.iconManager = {
                refresh: function () {
                    if (window.lucide && typeof window.lucide.createIcons === 'function') {
                        try {
                            window.lucide.createIcons();
                            console.log('🔄 Icons refreshed successfully');
                        } catch (error) {
                            console.error('❌ Icon refresh error:', error);
                        }
                    } else {
                        console.warn('⚠️ Lucide not available for refresh');
                    }
                }
            };

            // Multiple icon initialization attempts
            const iconInitIntervals = [500, 1000, 2000, 3000];
            iconInitIntervals.forEach(delay => {
                setTimeout(() => {
                    if (window.iconManager) {
                        window.iconManager.refresh();
                    }
                }, delay);
            });

            // --- REVISION ILLUSTRATION ANIMATION ---
            const revisionSvgContainer = document.getElementById('revision-svg-container');
            const revisionReadingSvg = document.getElementById('revision-reading-svg');
            const lightBeam = document.getElementById('light-beam');
            const lampHead = document.getElementById('lamp-head');

            // Cat eye elements
            const leftPupilGroup = document.getElementById('left-pupil-group');
            const rightPupilGroup = document.getElementById('right-pupil-group');

            // --- Lamp Movement Variables ---
            let targetLampRotation = 0;
            let currentLampRotation = 0;
            const LAMP_DAMPING_FACTOR = 0.15;
            const PIVOT_X_SVG = 1310;
            const PIVOT_Y_SVG = 105;
            const INITIAL_LIGHT_ANGLE = 150;
            const MAX_ROTATION = 15;
            const MIN_ROTATION = -15;

            // --- Eye Reading Animation Variables ---
            let pupilPositionX = 0;
            const MAX_PUPIL_MOVEMENT_X = 2.5; // Max horizontal movement in SVG units
            const READING_SPEED = 0.005; // Speed of oscillation (lower is slower)

            // Function to convert screen coordinates (clientX, clientY) to SVG coordinates
            function screenToSvg(clientX, clientY, svgElement) {
                const CTM = svgElement.getScreenCTM();
                if (!CTM) return { x: 0, y: 0 };
                return {
                    x: (clientX - CTM.e) / CTM.a,
                    y: (clientY - CTM.f) / CTM.d
                };
            }

            // --- Lamp Movement Logic ---
            function handleMouseMove(event) {
                if (!revisionReadingSvg) return;

                const cursorSvg = screenToSvg(event.clientX, event.clientY, revisionReadingSvg);
                const dx = cursorSvg.x - PIVOT_X_SVG;
                const dy = cursorSvg.y - PIVOT_Y_SVG;

                let angleRad = Math.atan2(dy, dx);
                let angleDeg = angleRad * (180 / Math.PI);

                let rotation = angleDeg - INITIAL_LIGHT_ANGLE;

                if (rotation > 180) {
                    rotation -= 360;
                } else if (rotation < -180) {
                    rotation += 360;
                }

                targetLampRotation = Math.max(MIN_ROTATION, Math.min(MAX_ROTATION, rotation));
            }

            // --- Animation Loop ---
            function animateLoop(timestamp) {
                // 1. Lamp Movement (Damping)
                const difference = targetLampRotation - currentLampRotation;
                currentLampRotation += difference * LAMP_DAMPING_FACTOR;

                if (lampHead) {
                    lampHead.style.transform = `rotate(${currentLampRotation}deg)`;
                }
                if (lightBeam) {
                    lightBeam.style.transform = `rotate(${currentLampRotation}deg)`;
                }

                // 2. Eye Reading Movement (Smooth Sinusoidal Oscillation)
                // Use Math.sin to get a smooth oscillation between -1 and 1
                const sinValue = Math.sin(timestamp * READING_SPEED);
                // Map the value to the desired movement range
                pupilPositionX = sinValue * MAX_PUPIL_MOVEMENT_X;

                if (leftPupilGroup && rightPupilGroup) {
                    // Apply the translation
                    leftPupilGroup.style.transform = `translate(${pupilPositionX}px, 0)`;
                    rightPupilGroup.style.transform = `translate(${pupilPositionX}px, 0)`;
                }

                // Request the next frame to keep the animation going
                requestAnimationFrame(animateLoop);
            }

            // Initialize revision illustration with enhanced setup
            if (revisionSvgContainer && revisionReadingSvg) {
                revisionSvgContainer.addEventListener('mousemove', handleMouseMove);
                revisionReadingSvg.setAttribute('role', 'img');
                revisionReadingSvg.setAttribute('aria-label', 'Interactive illustration of a cat reading in bed with a lamp that follows your cursor and eyes that move while reading');
                // Start the continuous animation loop
                animateLoop(0); // Start timestamp at 0
            }

            // Initialize reminders board
            renderReminders();
        });

    </script>

    <!-- MAIN APPLICATION CONTAINER -->
    <div class="flex flex-col lg:flex-row h-screen bg-[var(--bg-dark-1)]">

        <!-- SIDEBAR -->
        <aside id="sidebar"
            class="hidden lg:flex flex-col w-[280px] glass-sidebar p-8 pt-20 flex-shrink-0 overflow-y-auto scroll-hidden">

            <!-- Profile and Notifications -->
            <div class="flex items-center justify-between px-2 mb-10">
                <div class="flex items-center space-x-4">
                    <div class="relative"> <!-- wrapper to allow badge overflow -->
                        <a href="profile.html"
                            class="block w-12 h-12 rounded-full overflow-hidden bg-[#84D0F7] border-2 border-white/50 flex items-center justify-center hover:scale-105 transition-transform duration-200 cursor-pointer">
                            <div id="user-initials" class="text-lg font-medium text-black">A</div>
                        </a>
                        <!-- Notification badge overlay (positioned relative to wrapper) -->
                        <button id="notification-btn" aria-label="Notifications"
                            class="absolute -right-2 -top-2 w-8 h-8 bg-[var(--bg-dark-1)]/90 backdrop-blur-sm rounded-full flex items-center justify-center border border-white/10 shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-teal-500"
                            title="Notifications">
                            <span class="w-6 h-6 rounded-full bg-[#111111] flex items-center justify-center">
                                <i data-lucide="bell" class="text-white w-4 h-4"></i>
                            </span>
                        </button>
                    </div>
                    <div>
                        <div id="user-name" class="font-normal text-sm">User</div>
                        <!-- REDUCED from text-base -->
                        <div id="user-email" class="font-light text-xs opacity-70">user@upsc.com</div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="space-y-1.5 pt-10">
                <a href="db.html" class="nav-item active flex items-center space-x-5 px-8 py-2.5 rounded-full">
                    <i data-lucide="layout-dashboard" class="text-white w-5 h-5"></i>
                    <span class="font-normal text-sm">Dashboard</span>
                </a>
                <a href="learn.html" class="nav-item flex items-center space-x-5 px-8 py-2.5 rounded-full">
                    <i data-lucide="book-open" class="text-white opacity-50 w-5 h-5"></i>
                    <span class="font-normal text-sm text-white opacity-50">Learn</span>
                </a>
                <a href="statistics.html" class="nav-item flex items-center space-x-5 px-8 py-2.5 rounded-full">
                    <i data-lucide="bar-chart-2" class="text-white opacity-50 w-5 h-5"></i>
                    <span class="font-normal text-sm text-white opacity-50">Statistics</span>
                </a>
                <a href="news.html" class="nav-item flex items-center space-x-5 px-8 py-2.5 rounded-full">
                    <i data-lucide="newspaper" class="text-white opacity-50 w-5 h-5"></i>
                    <span class="font-normal text-sm text-white opacity-50">News</span>
                </a>
                <a href="community.html" class="nav-item flex items-center space-x-5 px-8 py-2.5 rounded-full">
                    <i data-lucide="users" class="text-white opacity-50 w-5 h-5"></i>
                    <span class="font-normal text-sm text-white opacity-50">Community</span>
                </a>
                <a href="chatbot.html" class="nav-item flex items-center space-x-5 px-8 py-2.5 rounded-full">
                    <div
                        class="w-6 h-6 bg-[#84D0F7] rounded-full flex items-center justify-center text-xs font-medium text-black flex-shrink-0">
                        AI</div>
                    <span class="font-normal text-sm text-white opacity-50">AI Assistant</span>
                </a>
            </nav>

            <!-- Bookmarks Section -->
            <div class="mt-8 pt-6 border-t border-white/10">
                <button id="bookmarks-btn"
                    class="nav-item flex items-center space-x-5 px-8 py-2.5 rounded-full w-full text-left">
                    <i data-lucide="bookmark" class="text-white opacity-50 w-5 h-5"></i>
                    <span class="font-normal text-sm text-white opacity-50">Bookmarks</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main id="main-content" role="main" tabindex="-1"
            class="flex-1 p-6 lg:p-8 overflow-y-auto scroll-hidden page-transition">

            <!-- Search Bar -->
            <form onsubmit="handleSearch(event)"
                class="glass-search-container flex items-center rounded-[2.5rem] p-1.5 mb-6 w-full max-w-7xl mx-auto">
                <i data-lucide="search"
                    class="search-icon text-white/70 w-5 h-5 mx-4 flex-shrink-0 transition-colors duration-300"></i>
                <label for="search-input" class="sr-only">Search</label>
                <input type="text" id="search-input" aria-label="Search notes, flashcards, MCQs"
                    placeholder="Search notes, flashcards, MCQs..."
                    class="bg-transparent text-white placeholder-[var(--text-faded)] text-sm font-normal flex-grow focus:outline-none py-2"
                    autocomplete="off" />
                <div class="arrow-circle-button" onclick="handleSearch(event)">
                    <i data-lucide="arrow-right" class="text-white w-5 h-5"></i>
                </div>
            </form>

            <!-- Responsive Grid Layout: Content (Left) & Widgets (Right) -->
            <div class="lg:grid lg:grid-cols-[1fr_360px] lg:gap-8 w-full max-w-7xl mx-auto">

                <!-- LEFT COLUMN: Revision Card, Filters, and Content List -->
                <div class="space-y-6">

                    <!-- Revision Due Today Card -->
                    <div
                        class="relative glass-card rounded-2xl overflow-hidden w-full shadow-2xl hover:shadow-3xl transition-all duration-300 border border-white/10 min-h-[200px]">
                        <!-- Background SVG Animation -->
                        <div id="revision-svg-container" class="absolute inset-0 w-full h-full">
                            <svg id="revision-reading-svg" width="100%" height="100%" viewBox="0 0 1338 394" fill="none"
                                xmlns="http://www.w3.org/2000/svg" class="w-full h-full block"
                                preserveAspectRatio="xMaxYMid slice">
                                <g clip-path="url(#clip0_187_723)">
                                    <rect width="1338" height="394" fill="white" />
                                    <!-- Yellow Background Shapes (Background Fill) -->
                                    <ellipse cx="732.91" cy="213.853" rx="116.088" ry="105.3" fill="#FCD54C" />
                                    <ellipse cx="687.854" cy="78.0308" rx="116.088" ry="105.3" fill="#FCD54C" />
                                    <ellipse cx="1241.03" cy="319.154" rx="116.088" ry="105.3" fill="#FCD54C" />
                                    <circle cx="778.544" cy="373.5" r="153.357" fill="#FCD54C" />
                                    <rect x="-87.3691" y="-111.869" width="1447.51" height="596.088" fill="#FCD54C" />
                                    <!-- Light Beam (ID required for rotation) -->
                                    <path id="light-beam"
                                        d="M1194.09 65.5721C1217.74 61.2582 1232.34 90.521 1214.68 106.82L279.304 969.944C267.555 980.785 248.691 977.326 241.553 963.022L-75.1602 328.337C-82.298 314.033 -73.7194 296.88 -57.993 294.011L1194.09 65.5721Z"
                                        fill="#FBE89C" />
                                    <!-- Bed/Pillow/Figure Container (White Shapes) -->
                                    <rect x="964.442" y="160.428" width="205.385" height="134.538" rx="20"
                                        fill="white" />
                                    <rect x="899.051" y="280.428" width="328.514" height="134.538" rx="20"
                                        fill="white" />
                                    <rect x="911.535" y="183.622" width="303.718" height="110.844" rx="3.5"
                                        stroke="white" />
                                    <!-- Cat Head/Ears/Body -->
                                    <path
                                        d="M1018.69 107.906C1018.48 104.554 1022.35 102.531 1025.11 104.551L1040.16 115.564C1042.54 117.309 1042.3 120.872 1039.71 122.23L1025.79 129.503C1023.2 130.861 1020.01 129.092 1019.83 126.194L1018.69 107.906Z"
                                        fill="#EEB34F" />
                                    <path
                                        d="M1093.11 104.23C1095.4 101.719 1099.57 102.942 1100.05 106.265L1102.68 124.415C1103.1 127.302 1100.34 129.676 1097.52 128.85L1082.39 124.414C1079.57 123.588 1078.62 120.125 1080.61 117.943L1093.11 104.23Z"
                                        fill="#EEB34F" />
                                    <path
                                        d="M1027.23 181.188C1041.96 151.658 1084.1 151.658 1098.82 181.188L1109.35 202.286C1122.61 228.879 1103.27 260.138 1073.55 260.138H1052.51C1022.79 260.138 1003.45 228.879 1016.71 202.286L1027.23 181.188Z"
                                        fill="#FECD5F" />
                                    <path
                                        d="M1024.64 150.52C1024.64 133.703 1038.27 120.069 1055.09 120.069H1072.14C1088.95 120.069 1102.59 133.703 1102.59 150.52V150.52C1102.59 167.337 1088.95 180.97 1072.14 180.97H1055.09C1038.27 180.97 1024.64 167.337 1024.64 150.52V150.52Z"
                                        fill="#ECB354" />
                                    <path
                                        d="M1022.56 115.772C1022.38 112.366 1026.26 110.302 1028.98 112.367L1043.72 123.573C1046.04 125.34 1045.75 128.921 1043.17 130.29L1029.46 137.57C1026.88 138.939 1023.75 137.174 1023.59 134.259L1022.56 115.772Z"
                                        fill="#EC755B" />
                                    <path
                                        d="M1091.3 111.313C1093.67 108.859 1097.83 110.308 1098.16 113.703L1099.96 132.13C1100.24 135.036 1097.42 137.257 1094.66 136.296L1080 131.187C1077.24 130.226 1076.41 126.731 1078.44 124.631L1091.3 111.313Z"
                                        fill="#EC755B" />
                                    <path
                                        d="M1015.17 144.135C1015.17 129.186 1027.29 117.067 1042.23 117.067H1081.52C1096.47 117.067 1108.59 129.186 1108.59 144.135V144.135C1108.59 162.821 1093.44 177.968 1074.75 177.968H1049C1030.31 177.968 1015.17 162.821 1015.17 144.135V144.135Z"
                                        fill="#FECD60" />
                                    <!-- Eyes and Mouth/Nose -->
                                    <circle cx="1045" cy="142.371" r="9.4953" fill="white" />
                                    <g id="left-pupil-group">
                                        <circle cx="1043" cy="147.071" r="4.69958" fill="#1E1E1E" />
                                    </g>
                                    <circle cx="1077.23" cy="142.371" r="9.4953" fill="white" />
                                    <g id="right-pupil-group">
                                        <circle cx="1075.23" cy="147.071" r="4.69958" fill="#1E1E1E" />
                                    </g>
                                    <path
                                        d="M1059.87 153.969V157.456M1059.87 157.456L1057.4 160.652M1059.87 157.456L1063.5 160.652"
                                        stroke="#670B0B" />
                                    <path
                                        d="M1059.42 155.017C1059.82 155.572 1060.64 155.572 1061.04 155.017L1063.71 151.309C1064.18 150.648 1063.71 149.726 1062.89 149.726H1057.56C1056.75 149.726 1056.28 150.648 1056.75 151.309L1059.42 155.017Z"
                                        fill="#F05781" />
                                    <!-- Book -->
                                    <rect x="1063.83" y="189.148" width="68.7344" height="95.2148" fill="#FF6A10" />
                                    <rect x="1001.79" y="189.148" width="67.9844" height="95.2148" fill="#E65F0E" />
                                    <!-- Lamp Fixture (ID required for rotation) -->
                                    <g id="lamp-head">
                                        <!-- Lamp Shade -->
                                        <path
                                            d="M1231.82 113.901C1236.05 111.267 1239.72 107.826 1242.62 103.774C1245.52 99.7224 1247.6 95.1389 1248.73 90.2854C1249.86 85.432 1250.02 80.4037 1249.2 75.4877C1248.39 70.5716 1246.62 65.8641 1243.98 61.6338C1241.35 57.4036 1237.91 53.8985 1233.86 50.998C1229.8 47.9325 1225.22 45.8586 1220.37 44.7295C1215.51 43.6004 1210.48 43.4384 1205.53 44.4176C1200.61 45.2318 1195.91 47.0063 1191.71 49.6398L1211.77 81.6877L1231.82 113.901Z"
                                            fill="#6389C2" />
                                        <!-- Mask and Highlight Group -->
                                        <mask id="mask0_187_723" style="mask-type:alpha" maskUnits="userSpaceOnUse"
                                            x="1191" y="43" width="59" height="72">
                                            <path
                                                d="M1231.78 114.066C1236.01 111.432 1239.68 107.991 1242.59 103.939C1245.49 99.8874 1247.56 95.3039 1248.69 90.4505C1249.82 85.5971 1249.98 80.5688 1249.17 75.6527C1248.35 70.7367 1246.58 66.0291 1243.94 61.7989C1241.31 57.5686 1237.87 53.8985 1233.82 50.998C1229.77 48.0976 1225.18 46.0236 1220.33 44.8945C1215.51 43.7655 1210.48 43.6034 1205.53 44.4176C1200.61 45.2318 1195.91 47.0063 1191.68 49.6398L1211.73 81.8528L1231.78 114.066Z"
                                                fill="#6389C2" />
                                        </mask>
                                        <g mask="url(#mask0_187_723)">
                                            <rect x="1202.73" y="-6.39746" width="59.5371" height="149.745"
                                                transform="rotate(-14.3633 1202.73 -6.39746)" fill="#597DB0" />
                                        </g>
                                        <!-- Lamp Arm/Stem (ID required for CSS transform origin) -->
                                        <path id="lamp-arm"
                                            d="M1242.64 62.2923C1283.55 32.9865 1305.12 34.0079 1341.47 62.2923"
                                            stroke="#597DAF" stroke-width="5" />
                                    </g>
                                    <!-- Paws holding the book -->
                                    <path
                                        d="M998.121 223.252C998.121 220.75 1000.15 218.721 1002.65 218.721H1010.62C1016.23 218.721 1020.78 223.27 1020.78 228.882V228.882C1020.78 234.494 1016.23 239.044 1010.62 239.044H1002.65C1000.15 239.044 998.121 237.015 998.121 234.512V223.252Z"
                                        fill="#FECD60" />
                                    <path
                                        d="M1134.78 223.252C1134.78 220.75 1132.75 218.721 1130.25 218.721H1122.28C1116.67 218.721 1112.12 223.27 1112.12 228.882V228.882C1112.12 234.494 1116.67 239.044 1122.28 239.044H1130.25C1132.75 239.044 1134.78 237.015 1134.78 234.512V223.252Z"
                                        fill="#FECD60" />
                                    <!-- Paw details -->
                                    <line x1="1014.4" y1="226.091" x2="1019.85" y2="226.091" stroke="white"
                                        stroke-linecap="round" />
                                    <line x1="1014.4" y1="231.979" x2="1019.85" y2="231.979" stroke="white"
                                        stroke-linecap="round" />
                                    <line x1="1113.4" y1="226.091" x2="1118.85" y2="226.091" stroke="white"
                                        stroke-linecap="round" />
                                    <line x1="1113.4" y1="231.979" x2="1118.85" y2="231.979" stroke="white"
                                        stroke-linecap="round" />
                                </g>
                                <defs>
                                    <clipPath id="clip0_187_723">
                                        <rect width="1338" height="394" fill="white" />
                                    </clipPath>
                                </defs>
                            </svg>
                        </div>

                        <!-- Content Overlay -->
                        <div class="relative z-10 flex items-center justify-start p-6 md:p-8 h-full">
                            <div class="space-y-3 max-w-md">
                                <h2 class="text-xl font-medium text-white leading-tight drop-shadow-lg">Revision Due
                                    Today</h2>
                                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-2">
                                    <button onclick="window.location.href='revision-new.html'"
                                        class="bg-green-600 hover:bg-green-700 btn-unified w-fit px-5 py-1.5 text-white font-medium text-sm shadow-lg transition-colors">
                                        <i data-lucide="zap" class="w-4 h-4 mr-1 inline-block"></i> Start Now
                                    </button>
                                    <button onclick="handleSnooze()"
                                        class="bg-white/20 hover:bg-white/30 backdrop-blur-sm btn-unified w-fit px-4 py-1.5 text-white font-normal text-sm flex items-center justify-center transition-colors">
                                        <i data-lucide="bell-off" class="w-4 h-4 mr-1"></i> Snooze (24 Hrs)
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Filter Chips -->
                    <div id="filter-chips" class="flex flex-wrap gap-2">
                        <!-- Chips rendered here by JS -->
                    </div>

                    <!-- Content List Grid -->
                    <h3 class="text-base font-semibold text-white pt-2">Admin Uploaded Content</h3>
                    <div id="content-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-2 content-grid-tight">
                        <!-- Content cards rendered here by JS -->
                    </div>
                </div>

                <!-- RIGHT COLUMN: Widgets (Quiz & Flashcards) -->
                <div class="mt-8 lg:mt-0 space-y-6">

                    <!-- Daily Quiz Widget -->
                    <div id="daily-quiz-widget"
                        class="bg-[var(--bg-dark-2)] rounded-2xl p-5 shadow-xl space-y-3 border border-white/10">
                        <div class="flex items-center justify-between">
                            <h4 class="text-base font-semibold text-white flex items-center gap-2">
                                Daily Challenge <i data-lucide="trophy" class="w-5 h-5 text-yellow-400"></i>
                            </h4>
                            <span id="question-counter" class="text-xs text-white/60">Question 1 of 10</span>
                        </div>
                        <p id="daily-quiz-question" class="text-white/80 font-normal leading-snug text-sm">
                            <!-- Question will be populated by JS -->
                        </p>
                        <div id="quiz-options" class="space-y-2" role="radiogroup"
                            aria-labelledby="daily-quiz-question">
                            <!-- Options rendered by JS -->
                        </div>
                        <div id="quiz-feedback" class="pt-2 hidden">
                            <!-- Feedback rendered by JS -->
                        </div>
                        <div id="quiz-actions" class="pt-3">
                            <button id="check-answer-btn" onclick="checkQuizAnswer()"
                                class="btn-primary-gradient btn-unified w-full px-4 py-1.5 text-white font-medium text-sm">
                                Check Answer
                            </button>
                            <button id="next-question-btn" onclick="nextQuestion()"
                                class="btn-primary-gradient btn-unified w-full px-4 py-1.5 text-white font-medium text-sm hidden mt-2">
                                Next Question
                            </button>
                            <button id="retry-quiz-btn" onclick="resetQuiz()"
                                class="btn-secondary-subtle btn-unified w-full px-4 py-1.5 text-white font-medium text-sm hidden mt-2">
                                Restart Challenge
                            </button>
                        </div>
                    </div>

                    <!-- Flashcard Carousel -->
                    <div id="flashcard-carousel"
                        class="bg-[var(--bg-dark-2)] rounded-2xl p-5 shadow-xl space-y-3 border border-white/10">
                        <h4 class="text-base font-semibold text-white flex items-center justify-between">
                            Rapid Flashcards <i data-lucide="zap" class="w-5 h-5 text-red-400"></i>
                        </h4>
                        <div id="flashcard-container"
                            class="relative h-40 flex items-center justify-center perspective-1000">
                            <!-- Card content goes here -->
                        </div>
                        <div class="flex justify-between space-x-3">
                            <button id="flashcard-prev" onclick="navigateFlashcard('prev')"
                                class="btn-secondary-subtle w-1/2 px-3 py-1.5 text-white rounded-xl text-sm disabled:opacity-30">
                                <i data-lucide="arrow-left" class="w-4 h-4 inline-block mr-1"></i> Back
                            </button>
                            <button id="flashcard-next" onclick="navigateFlashcard('next')"
                                class="btn-primary-gradient w-1/2 px-3 py-1.5 text-white font-medium rounded-xl text-sm disabled:opacity-30">
                                Next <i data-lucide="arrow-right" class="w-4 h-4 inline-block ml-1"></i>
                            </button>
                        </div>
                        <div class="flex justify-center space-x-3 pt-2">
                            <button onclick="flashcardAction('learned')"
                                class="text-xs font-medium text-green-400 hover:text-green-300 transition">
                                <i data-lucide="check-circle" class="w-4 h-4 mr-1 inline-block"></i> Mark as Learned
                            </button>
                            <span class="text-white/50">|</span>
                            <button onclick="flashcardAction('weak')"
                                class="text-xs font-medium text-red-400 hover:text-red-300 transition">
                                <i data-lucide="alert-triangle" class="w-4 h-4 mr-1 inline-block"></i> Weak Area
                            </button>
                        </div>
                    </div>

                    <!-- Reminders Board Widget -->
                    <div id="reminders-board"
                        class="bg-[var(--bg-dark-2)] rounded-2xl shadow-xl border border-white/10 transition-all duration-300">
                        <!-- Header -->
                        <div class="flex items-center justify-between p-4 border-b border-white/10">
                            <h4 class="text-base font-semibold text-white flex items-center gap-2">
                                <i data-lucide="sticky-note" class="w-5 h-5 text-yellow-400"></i>
                                Reminders Board
                            </h4>
                            <div class="flex items-center gap-2">
                                <button id="add-reminder-btn" onclick="addNewReminder()"
                                    class="bg-teal-600 hover:bg-teal-700 px-3 py-1 rounded-lg text-white text-xs font-medium transition-colors"
                                    title="Add New Reminder">
                                    <i data-lucide="plus" class="w-3 h-3 mr-1 inline-block"></i> New
                                </button>
                                <button id="minimize-board-btn" onclick="toggleBoard()"
                                    class="text-white/60 hover:text-white p-1 rounded transition-colors"
                                    title="Minimize Board">
                                    <i data-lucide="minus" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Board Content -->
                        <div id="board-content" class="p-4 min-h-[200px] max-h-[400px] overflow-y-auto">
                            <div id="reminders-container" class="grid grid-cols-1 gap-3">
                                <!-- Reminders will be added here -->
                            </div>

                            <!-- Empty State -->
                            <div id="empty-state" class="text-center py-8 text-white/50">
                                <i data-lucide="sticky-note" class="w-12 h-12 mx-auto mb-3 opacity-30"></i>
                                <p class="text-sm">No reminders yet</p>
                                <p class="text-xs mt-1">Click "New" to add your first reminder</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>
</body>

</html>